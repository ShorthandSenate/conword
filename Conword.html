document.addEventListener("DOMContentLoaded", function() {
    var container = document.getElementById('clipList');
    var isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    // ฟังก์ชันการลากทั่วไป (สำหรับ PC)
    var drake = dragula([container], {
        moves: function (el, source, handle, sibling) {
            return !isTouchDevice; // สำหรับอุปกรณ์สัมผัสจะไม่อนุญาตให้ลาก
        }
    });

    // เพิ่มปุ่มปรับรายการสำหรับอุปกรณ์สัมผัส
    if (isTouchDevice) {
        var adjustButton = document.createElement('button');
        adjustButton.textContent = 'ปรับรายการ';
        adjustButton.addEventListener('click', toggleAdjustMode);
        container.appendChild(adjustButton);
        
        function toggleAdjustMode() {
            var items = container.querySelectorAll('li');
            items.forEach(function(item) {
                var upButton = document.createElement('button');
                var downButton = document.createElement('button');
                var finishButton = document.createElement('button');

                upButton.textContent = 'เลื่อนขึ้น';
                downButton.textContent = 'เลื่อนลง';
                finishButton.textContent = 'เสร็จสิ้น';

                // เพิ่มฟังก์ชันเลื่อนขึ้น
                upButton.addEventListener('click', function() {
                    var prevItem = item.previousElementSibling;
                    if (prevItem) {
                        container.insertBefore(item, prevItem);
                    }
                });

                // เพิ่มฟังก์ชันเลื่อนลง
                downButton.addEventListener('click', function() {
                    var nextItem = item.nextElementSibling;
                    if (nextItem) {
                        container.insertBefore(nextItem, item);
                    }
                });

                // ซ่อนปุ่มเมื่อเสร็จสิ้น
                finishButton.addEventListener('click', function() {
                    upButton.remove();
                    downButton.remove();
                    finishButton.remove();
                    saveClipListToLocalStorage(); // บันทึกลำดับใหม่ลงใน localStorage
                });

                item.appendChild(upButton);
                item.appendChild(downButton);
                item.appendChild(finishButton);
            });
        }
    }

    drake.on('drop', function() {
        saveClipListToLocalStorage(); // บันทึกลำดับใหม่ลงใน localStorage
    });

    // ฟังก์ชันการบันทึกลิสต์ใน localStorage
    function saveClipListToLocalStorage() {
        var items = Array.from(container.querySelectorAll('li'));
        var clipListOrder = items.map(function(item) {
            return item.textContent; // หรือข้อมูลที่คุณต้องการบันทึก
        });
        localStorage.setItem('clipListOrder', JSON.stringify(clipListOrder));
    }
});
